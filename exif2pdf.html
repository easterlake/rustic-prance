<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>File Info and EXIF Reader (Full-Width Thumbnail & Multi Export + ZIP)</title>
  <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/caldwell/renderjson/renderjson.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f6f8fa; }
    .thumbnail-container {
      margin-bottom: 0.5em;
      width: 100%;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    .thumbnail {
      border: 2px solid #444;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      width: 100%;
      height: auto;
      display: block;
      margin-bottom: 0.5em;
      object-fit: contain;
      background: #fff;
    }
    .export-buttons {
      display: flex;
      gap: 0.5em;
      margin-bottom: 1em;
      flex-wrap: wrap;
    }
    pre, .json-output {
      background: #23272e;
      color: #f8f8f2;
      padding: 1em;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 1em;
      line-height: 1.5;
      margin-bottom: 1em;
    }
    .json-output {
      font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
      margin: 0;
      border: none;
      background: #23272e;
      color: #f8f8f2;
      padding: 1em;
    }
    /* Enhanced JSON styling for renderjson */
    .renderjson-key        { color: #268bd2; font-weight: bold; }
    .renderjson-string     { color: #2aa198; }
    .renderjson-number     { color: #b58900; }
    .renderjson-boolean    { color: #cb4b16; }
    .renderjson-null       { color: #d33682; }
    .renderjson-mark       { background: #44475a; }
    .renderjson-link       { color: #6c71c4; text-decoration: underline; }
    .renderjson-toggle     { color: #ff6188; cursor: pointer; font-weight: bold; }
    .renderjson-separator  { color: #839496; }
    .renderjson-object     { color: #859900; }
    .renderjson-array      { color: #b58900; }
    .renderjson-more       { color: #cb4b16; cursor: pointer; }
    button {
      padding: 0.5em 1em;
      font-size: 1em;
      background: #268bd2;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #155ab6;
    }
  </style>
</head>
<body>

  <h3>Select an image file</h3>
  <input type="file" id="fileInput" accept="image/*">
  <div class="thumbnail-container">
    <img id="thumbnail" class="thumbnail" style="display:none;" alt="Image Thumbnail Preview">
    <div class="export-buttons">
      <button id="downloadPdf" style="display:none;">Download PDF</button>
      <button id="downloadCsv" style="display:none;">Download CSV</button>
      <button id="downloadTxt" style="display:none;">Download TXT</button>
      <button id="downloadJson" style="display:none;">Download JSON</button>
      <button id="downloadZip" style="display:none;">Download ZIP</button>
    </div>
  </div>
  <h3>File Info</h3>
  <pre id="fileInfo"></pre>
  <h3>MD5 Hash</h3>
  <pre id="md5"></pre>
  <h3>EXIF Data</h3>
  <div id="exif" class="json-output"></div>

  <script>
    let lastFileInfo = '';
    let lastMd5 = '';
    let lastExif = {};
    let lastThumbnailDataUrl = '';
    let lastFileName = 'image';

    renderjson.set_show_to_level(2);

    function showExportButtons(show) {
      document.getElementById('downloadPdf').style.display = show ? 'inline-block' : 'none';
      document.getElementById('downloadCsv').style.display = show ? 'inline-block' : 'none';
      document.getElementById('downloadTxt').style.display = show ? 'inline-block' : 'none';
      document.getElementById('downloadJson').style.display = show ? 'inline-block' : 'none';
      document.getElementById('downloadZip').style.display = show ? 'inline-block' : 'none';
    }

    document.getElementById('fileInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;
      lastFileName = file.name ? file.name.replace(/\.[^/.]+$/, "") : 'image';

      // Display file info
      lastFileInfo = `Name: ${file.name}\nSize: ${file.size} bytes\nType: ${file.type}`;
      document.getElementById('fileInfo').textContent = lastFileInfo;

      // Generate and display thumbnail
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          lastThumbnailDataUrl = e.target.result;
          const imgEl = document.getElementById('thumbnail');
          imgEl.src = lastThumbnailDataUrl;
          imgEl.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        document.getElementById('thumbnail').style.display = 'none';
        lastThumbnailDataUrl = '';
      }

      // Compute MD5 hash
      const md5Reader = new FileReader();
      md5Reader.onload = function(e) {
        const arrayBuffer = e.target.result;
        let binary = '';
        const bytes = new Uint8Array(arrayBuffer);
        for (let i = 0; i < bytes.byteLength; i++) {
          binary += String.fromCharCode(bytes[i]);
        }
        lastMd5 = md5(binary);
        document.getElementById('md5').textContent = lastMd5;
      };
      md5Reader.readAsArrayBuffer(file);

      // Extract EXIF data (only works for JPEG, TIFF)
      const exifReader = new FileReader();
      exifReader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          EXIF.getData(img, function() {
            lastExif = EXIF.getAllTags(this);
            const exifDiv = document.getElementById('exif');
            exifDiv.innerHTML = '';
            exifDiv.appendChild(renderjson(lastExif));
            showExportButtons(true);
          });
        };
        img.src = e.target.result;
      };
      exifReader.readAsDataURL(file);
    });

    // PDF Export
    function generatePdfBlob(callback) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'mm', format: 'a4' });
      const pageWidth = 210;
      const pageHeight = 297;
      const margin = 10;
      let y = 20;
      const now = new Date();
      const dateStr = now.toLocaleString();
      doc.setFontSize(10);
      doc.text(`Generated: ${dateStr}`, margin, 10);
      doc.setFont("courier", "normal");
      doc.setFontSize(12);

      function addContentAndReturn(imgWidth, imgHeight) {
        let yPos = y;
        if (lastThumbnailDataUrl && imgWidth && imgHeight) {
          doc.text("Thumbnail:", margin, yPos);
          yPos += 5;
          const maxWidth = pageWidth - 2 * margin;
          const scale = Math.min(1, maxWidth / imgWidth);
          const drawWidth = imgWidth * scale;
          const drawHeight = imgHeight * scale;
          doc.addImage(lastThumbnailDataUrl, 'JPEG', margin, yPos, drawWidth, drawHeight);
          yPos += drawHeight + 5;
        }
        doc.text("File Info:", margin, yPos);
        yPos += 7;
        lastFileInfo.split('\n').forEach(line => {
          doc.text(line, margin + 2, yPos);
          yPos += 7;
        });
        doc.text("MD5 Hash:", margin, yPos);
        yPos += 7;
        doc.text(lastMd5, margin + 2, yPos);
        yPos += 10;
        doc.text("EXIF Data:", margin, yPos);
        yPos += 7;
        const exifStr = JSON.stringify(lastExif, null, 2);
        exifStr.split('\n').forEach(line => {
          if (yPos > pageHeight - 20) {
            doc.addPage();
            yPos = 20;
            doc.setFontSize(10);
            doc.text(`Generated: ${dateStr}`, margin, 10);
            doc.setFontSize(12);
            doc.text("EXIF Data (cont'd):", margin, yPos);
            yPos += 7;
          }
          doc.text(line, margin + 2, yPos);
          yPos += 6;
        });
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFontSize(10);
          doc.text(
            `Page ${i} of ${pageCount}`,
            pageWidth - margin,
            pageHeight - 7,
            { align: 'right' }
          );
        }
        callback(doc.output('blob'));
      }

      if (lastThumbnailDataUrl) {
        const img = new window.Image();
        img.onload = function() {
          addContentAndReturn(img.naturalWidth, img.naturalHeight);
        };
        img.onerror = function() { addContentAndReturn(0, 0); };
        img.src = lastThumbnailDataUrl;
      } else {
        addContentAndReturn(0, 0);
      }
    }

    document.getElementById('downloadPdf').addEventListener('click', function() {
      generatePdfBlob(function(blob) {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${lastFileName}_info.pdf`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
    });

    // CSV Export
    function getCsvContent() {
      let csv = `"Field","Value"\n`;
      csv += `"Name","${lastFileInfo.split('\n')[0].split(': ')[1] || ''}"\n`;
      csv += `"Size","${lastFileInfo.split('\n')[1].split(': ')[1] || ''}"\n`;
      csv += `"Type","${lastFileInfo.split('\n')[2].split(': ')[1] || ''}"\n`;
      csv += `"MD5","${lastMd5}"\n`;
      Object.entries(lastExif).forEach(([key, value]) => {
        csv += `"${key}","${typeof value === 'object' ? JSON.stringify(value) : value}"\n`;
      });
      return csv;
    }
    document.getElementById('downloadCsv').addEventListener('click', function() {
      const blob = new Blob([getCsvContent()], { type: "text/csv" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${lastFileName}_info.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    // TXT Export
    function getTxtContent() {
      return `${lastFileInfo}\n\nMD5 Hash: ${lastMd5}\n\nEXIF Data:\n${JSON.stringify(lastExif, null, 2)}`;
    }
    document.getElementById('downloadTxt').addEventListener('click', function() {
      const blob = new Blob([getTxtContent()], { type: "text/plain" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${lastFileName}_info.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    // JSON Export
    function getJsonContent() {
      return JSON.stringify({
        fileInfo: lastFileInfo,
        md5: lastMd5,
        exif: lastExif
      }, null, 2);
    }
    document.getElementById('downloadJson').addEventListener('click', function() {
      const blob = new Blob([getJsonContent()], { type: "application/json" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${lastFileName}_info.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    // ZIP Export
    document.getElementById('downloadZip').addEventListener('click', function() {
      const zip = new JSZip();
      // Add CSV, TXT, JSON
      zip.file(`${lastFileName}_info.csv`, getCsvContent());
      zip.file(`${lastFileName}_info.txt`, getTxtContent());
      zip.file(`${lastFileName}_info.json`, getJsonContent());
      // Add PDF (async)
      generatePdfBlob(function(pdfBlob) {
        zip.file(`${lastFileName}_info.pdf`, pdfBlob);
        zip.generateAsync({ type: "blob" }).then(function(content) {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(content);
          a.download = `${lastFileName}_info.zip`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        });
      });
    });
  </script>
</body>
</html>
